{"version":3,"file":"AuthView-BQEuqrR5.js","sources":["../../../.svelte-kit/adapter-node/chunks/AuthView.js"],"sourcesContent":["import { y as await_block, l as pop, p as push } from \"./index2.js\";\nimport \"clsx\";\nimport { A as ApiAuth } from \"./backend-services.js\";\nimport { S as StringUtils } from \"./err.js\";\nclass AuthStoreData {\n  _username;\n  _userId;\n  _lastFetched;\n  constructor(username, userId, lastFetched) {\n    this._username = username;\n    this._userId = userId;\n    this._lastFetched = lastFetched;\n  }\n  get Username() {\n    return this._username;\n  }\n  get UserId() {\n    return this._userId;\n  }\n  get LastFetched() {\n    return this._lastFetched;\n  }\n  isAuthenticated() {\n    return !StringUtils.isNullOrWhiteSpace(this.Username) && !StringUtils.isNullOrWhiteSpace(this.UserId);\n  }\n  update(username, userId) {\n    this._username = username;\n    this._userId = userId;\n    this._lastFetched = /* @__PURE__ */ new Date();\n  }\n  setEmpty() {\n    this._username = null;\n    this._userId = null;\n    this._lastFetched = /* @__PURE__ */ new Date();\n  }\n}\nconst authStoreData = new AuthStoreData(\"\", \"\", new Date(1970, 0, 0));\nasync function fetchAuthData() {\n  const response = await ApiAuth.fetchJsonResponse(\"/ping\", { method: \"POST\" });\n  if (response.isSuccess) {\n    authStoreData.update(response.data.username, response.data.userId);\n  } else {\n    authStoreData.setEmpty();\n  }\n}\nasync function getAuthData() {\n  let lastFetched = authStoreData.LastFetched;\n  const now = /* @__PURE__ */ new Date();\n  const two_minutes = 2 * 60 * 1e3;\n  if (!lastFetched || now.getTime() - lastFetched.getTime() > two_minutes) {\n    await fetchAuthData();\n  }\n  return authStoreData;\n}\nfunction AuthView($$payload, $$props) {\n  push();\n  const {\n    loading = null,\n    authenticated = null,\n    unauthenticated = null\n  } = $$props;\n  $$payload.out += `<!---->`;\n  await_block(\n    getAuthData(),\n    () => {\n      loading?.($$payload);\n      $$payload.out += `<!---->`;\n    },\n    (authData) => {\n      if (authData !== null && authData.isAuthenticated()) {\n        $$payload.out += \"<!--[-->\";\n        authenticated?.($$payload, authData);\n        $$payload.out += `<!---->`;\n      } else {\n        $$payload.out += \"<!--[!-->\";\n        unauthenticated?.($$payload);\n        $$payload.out += `<!---->`;\n      }\n      $$payload.out += `<!--]-->`;\n    }\n  );\n  $$payload.out += `<!---->`;\n  pop();\n}\nexport {\n  AuthView as A,\n  getAuthData as g\n};\n"],"names":[],"mappings":"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"}