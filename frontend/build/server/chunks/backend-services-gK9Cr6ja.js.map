{"version":3,"file":"backend-services-gK9Cr6ja.js","sources":["../../../.svelte-kit/adapter-node/chunks/backend-services.js"],"sourcesContent":["import { E as Err } from \"./err.js\";\nimport { D as DateUtils } from \"./date-utils.js\";\nclass BackendService {\n  _baseUrl;\n  constructor(baseUrl) {\n    this._baseUrl = baseUrl;\n  }\n  requestJsonOptions(data, method = \"POST\") {\n    return {\n      method,\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(data)\n    };\n  }\n  async fetchJsonResponse(url, options) {\n    try {\n      const response = await fetch(this._baseUrl + url, {\n        ...options,\n        credentials: \"include\"\n      });\n      console.log(response);\n      if (response.ok) {\n        const text = await response.text();\n        const data = BackendService.parseWithDates(text);\n        return { isSuccess: true, data };\n      }\n      const errors = await this.parseErrResponse(response);\n      return { isSuccess: false, errors };\n    } catch (e) {\n      return {\n        isSuccess: false,\n        errors: [new Err(\"Unknown error\", -1, \"Error: \" + e.message)]\n      };\n    }\n  }\n  async fetchVoidResponse(url, options) {\n    try {\n      const response = await fetch(this._baseUrl + url, {\n        ...options,\n        credentials: \"include\"\n      });\n      if (response.ok) {\n        return { isSuccess: true };\n      }\n      const errors = await this.parseErrResponse(response);\n      return { isSuccess: false, errors };\n    } catch (e) {\n      return {\n        isSuccess: false,\n        errors: [new Err(\"Unknown error\", -1, \"Error: \" + e.message)]\n      };\n    }\n  }\n  async serverFetchJsonResponse(fetchFunc, url, options) {\n    try {\n      const response = await fetchFunc(this._baseUrl + url, {\n        ...options,\n        credentials: \"include\"\n      });\n      console.log(response);\n      if (response.ok) {\n        const text = await response.text();\n        const data = BackendService.parseWithDates(text);\n        return { isSuccess: true, data };\n      }\n      const contentType = response.headers.get(\"content-type\");\n      if (contentType?.includes(\"application/json\")) {\n        const json = await response.json();\n        if (Array.isArray(json.errors)) {\n          return {\n            isSuccess: false,\n            errors: json.errors\n          };\n        }\n      }\n      return {\n        isSuccess: false,\n        errors: [{\n          message: \"Unknown error\",\n          code: -1,\n          details: \"Response was not valid JSON with an 'errors' array\"\n        }]\n      };\n    } catch (e) {\n      return {\n        isSuccess: false,\n        errors: [{\n          message: \"Unknown error\",\n          code: -1,\n          details: \"Exception: \" + e.message\n        }]\n      };\n    }\n  }\n  static parseWithDates(json) {\n    return JSON.parse(json, (key, value) => {\n      if (typeof value === \"string\" && DateUtils.isoDateRegex.test(value)) {\n        return new Date(value);\n      }\n      return value;\n    });\n  }\n  async parseErrResponse(response) {\n    if (response.headers.get(\"content-type\")?.includes(\"application/json\")) {\n      const json = await response.json();\n      if (!Array.isArray(json.errors)) {\n        return [new Err(\"Invalid error format\", -1, \"Expected 'errors' array in response\")];\n      }\n      return json.errors.map(Err.fromPlain);\n    }\n    return [new Err(\"Unknown error\", -1, \"Response not in JSON format\")];\n  }\n}\nconst ApiAuth = new BackendService(\"/api/auth\");\nconst ApiMain = new BackendService(\"/api/main\");\nexport {\n  ApiAuth as A,\n  ApiMain as a\n};\n"],"names":[],"mappings":"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"}