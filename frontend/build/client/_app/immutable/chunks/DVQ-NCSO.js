var U=Object.defineProperty;var O=(e,t,a)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var c=(e,t,a)=>O(e,typeof t!="symbol"?t+"":t,a);import"./CWj6FrbW.js";import{Z as T,p as b,f as i,a as k,i as _,o as f}from"./TlERTnYi.js";import{c as o,a as u}from"./CeeueTis.js";import{a as x}from"./B3uS-3am.js";import{i as E}from"./GGSi--Df.js";import{s as g}from"./DqFbyC95.js";import{p as v}from"./BC8zxhgT.js";import{A as L}from"./CrUDN0xC.js";import{S as A}from"./B-eBv7WL.js";class N{constructor(t,a,d){c(this,"_username");c(this,"_userId");c(this,"_lastFetched");this._username=t,this._userId=a,this._lastFetched=d}get Username(){return this._username}get UserId(){return this._userId}get LastFetched(){return this._lastFetched}isAuthenticated(){return!A.isNullOrWhiteSpace(this.Username)&&!A.isNullOrWhiteSpace(this.UserId)}update(t,a){this._username=t,this._userId=a,this._lastFetched=new Date}setEmpty(){this._username=null,this._userId=null,this._lastFetched=new Date}}const m=T(new N("","",new Date(1970,0,0)));async function W(){const e=await L.fetchJsonResponse("/ping",{method:"POST"});e.isSuccess?m.update(e.data.username,e.data.userId):m.setEmpty()}async function J(){let e=m.LastFetched;const t=new Date,a=2*60*1e3;return(!e||t.getTime()-e.getTime()>a)&&await W(),m}function H(e,t){b(t,!0);const a=v(t,"loading",3,null),d=v(t,"authenticated",3,null),F=v(t,"unauthenticated",3,null);var w=o(),I=i(w);x(I,J,l=>{var s=o(),h=i(s);g(h,()=>a()??f),u(l,s)},(l,s)=>{var h=o(),S=i(h);{var D=n=>{var r=o(),p=i(r);g(p,()=>d()??f,()=>_(s)),u(n,r)},y=n=>{var r=o(),p=i(r);g(p,()=>F()??f),u(n,r)};E(S,n=>{_(s)!==null&&_(s).isAuthenticated()?n(D):n(y,!1)})}u(l,h)}),u(e,w),k()}export{H as A,J as g};
